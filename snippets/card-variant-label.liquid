{% comment %}
  Renders a Custom Product Label for Product Cards

  Accepts:
  - card_product: {Object} Product Liquid object (required)
  - section_settings: {Object} Section settings object to allow clients to edit the product labels on the theme editor (optional)
  - section_id: {String} Section ID for unique identifiers (optional)
  Usage:
  {% render 'card-variant-label', card_product: card_product, section_settings: section.settings, section_id: section.id %}
{% endcomment %}

{%- liquid
assign current_variant = card_product.selected_or_first_available_variant

if section_settings != blank
  assign label_source = section_settings.variant_label_source | default: 'variant_metafields'

  if label_source == 'block_settings'
    assign variant_custom_text_label = section_settings.variant_custom_text_label
    assign variant_custom_text_color_label = section_settings.variant_custom_text_color_label
    assign variant_custom_background_color_label = section_settings.variant_custom_background_color_label
  else
    # Dynamic metafield keys from section settings
    assign metafield_namespace = section_settings.variant_metafield_namespace | default: 'custom'
    assign variant_text_label_key = section_settings.variant_text_label_key | default: 'text_label'
    assign variant_text_color_key = section_settings.variant_text_color_key | default: 'text_color_label'
    assign variant_background_color_key = section_settings.variant_background_color_key | default: 'background_color_label'

    # Access metafields using the dynamic keys
    assign variant_custom_text_label = current_variant.metafields[metafield_namespace][variant_text_label_key].value
    assign variant_custom_text_color_label = current_variant.metafields[metafield_namespace][variant_text_color_key].value
    assign variant_custom_background_color_label = current_variant.metafields[metafield_namespace][variant_background_color_key].value
  endif
else
  # Fallback to hardcoded metafield keys if no section settings are provided
  assign variant_custom_text_label = current_variant.metafields.custom.text_label.value
  assign variant_custom_text_color_label = current_variant.metafields.custom.text_color_label.value
  assign variant_custom_background_color_label = current_variant.metafields.custom.background_color_label.value
endif
-%}

{% if current_variant %}
  {% unless variant_custom_text_label == blank %}
    <span 
      class="card__variant-label" 
      id="card-variant-label-{{ section_id }}-{{ card_product.id }}" 
      style="color: {{ variant_custom_text_color_label }}; background: {{ variant_custom_background_color_label }};"
    >
      {{ variant_custom_text_label }}
    </span>
  {% endunless %}
{% endif %}